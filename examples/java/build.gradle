plugins {
    id 'java'
    id 'application'
    id 'net.thauvin.erik.gradle.semver' version '1.0.4'
    id 'com.github.ben-manes.versions' version '0.36.0'
}

// ./gradlew
// ./gradlew incrementPatch run
// ./gradlew incrementMinor run
// ./gradlew incrementMajor run
// ./gradlew incrementBuildMeta run
// ./gradlew echoVersion


defaultTasks 'run'

dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.7.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.7.0'
}

repositories {
    jcenter()
}

test {
    useJUnitPlatform()
}

application {
    mainClassName = 'App'
//    project.afterEvaluate {
//        println "Version: $version"
//    }
}    

semver {
//     properties = "example.properties"
//     keysPrefix = "example."
//     preReleaseKey = "release"
//     buildMetaKey = "meta"
}

incrementBuildMeta {
    doFirst {
//        buildMeta = sprintf("%03d", (buildMeta as Integer) + 1)
        buildMeta = new Date().format("yyyyMMddHHmmss")
    }
}

run {
    doFirst {
//        println "Version: ${-> version}"
        println "Version: $version"
    }

//    args = ['example.properties']
    args = ['version.properties']
}

task echoVersion(type:Exec) {
    commandLine 'echo', "${-> project.version}"
}
